# 三次握手与四次挥手

# HTTP与HTTPS

## 什么是HTTP

**超文本传输协议**(HyperText Transfer Protocol)，是一个基于**请求与响应**，**无状态**的，**应用层**的协议，常基于TCP/IP协议传输数据，互联网上应用最为广泛的一种网络协议。设计HTTP的初衷是为了**提供一种发布和接收HTML页面的方法**。


下图是Akamai公司建立的一个官方的演示，使用`HTTP/1.1`(1997年)和`HTTP/2`(2015年)同时请求379张图片，观察请求的时间，明显看出`HTTP/2`性能占优势：

<div align=center><img src=Pictures\Http1.1VS2.jpg></div>

`HTTP/2`采用**多路复用**技术：通过**单一的`HTTP/2`连接请求**发起**多重的请求-响应消息**，**多个请求stream共享一个TCP连接**，实现**多流并行**而**不是依赖建立多个TCP连接**。

### 常用的HTTP方法

- GET：用于**请求访问**已经被URI（Uniform Resource Identifier——统一资源标识符——表示的是web上每一种**可用的资源**，如 HTML文档、图像、视频片段、程序等）识别的资源，可以通过URL（Uniform Resource Locator——统一资源定位符）传参给服务器；
- POST：用于**传输信息给服务器**，主要功能与GET方法类似，但一般推荐使用POST方式。
- PUT：传输文件，报文主体中包含文件内容，保存到对应URI位置。
- HEAD：获得报文首部，与GET方法类似，只是不返回报文主体，一般用于验证URI是否有效。
- DELETE：删除文件，与PUT方法相反，删除对应URI位置的文件。
- OPTIONS：查询相应URI支持的HTTP方法。

### GET方法与POST方法的区别

- GET重点在从服务器上获取资源，POST重点在向服务器发送数据；
- GET传输数据是**通过URL请求**，以`field（字段）= value`的形式，置于URL后，并用"?"连接，多个请求数据间用"&"连接，如`http://127.0.0.1/Test/login.action?name=admin&password=admin`，这个过程**用户是可见**的；
    POST传输数据通过HTTP的POST机制，**将字段与对应值封存在请求实体中**发送给服务器，这个过程**对用户是不可见的**；
- GET方式只能支持ASCII字符，向服务器传的中文字符可能会乱码。
POST支持标准字符集，可以正确传递中文字符。

### HTTP请求报文与响应报文格式

请求报文包含三部分：
a、请求行：包含请求方法、URL、HTTP版本信息
b、请求首部字段
c、请求内容实体
响应报文包含三部分：
a、状态行：包含HTTP版本、状态码、状态码的原因短语
b、响应首部字段
c、响应内容实体

<div align=center><img src=Pictures\请求报文与响应报文.png></div>

### 常见的HTTP相应状态码
200：请求被正常处理
404：服务器无法找到对应资源
500：服务器内部错误


### 在浏览器输入网址后发生了什么

客户端输入URL回车，**DNS(Domain Name System)解析域名**得到服务器的IP地址，服务器在80**端口**监听客户端请求，端口通过**TCP/IP协议**建立连接。

**第一步：浏览器查找该域名的IP地址**

浏览器把域名发送给系统默认DNS服务器。如果该服务器本地有缓存，且缓存未过期，则直接返回结果否则向上一级DNS服务器查询，直到DNS根服务器。

**通过三次握手，建立了客户端和服务器之间的连接：**

**第二步：浏览器根据解析得到的IP地址向web服务器发送一个HTTP请求**

浏览器知道了网址的对应服务器IP地址和端口，然后就通过TCP协议发起网络请求。

**第三步：服务器收到请求并进行处理**

**第四步：服务器返回一个响应**

**第五步：浏览器对该响应进行解码，渲染显示**

**第六步：页面显示完成后，浏览器发送异步请求。**

页面显示完成后客户端仍与服务器端保持着联系。它会持续与服务器保持联系来及时更新一些页面信息。


## 什么是HTTPS

HTTPS是**身披SSL外壳的HTTP**。HTTPS是一种通过计算机网络进行**安全通信**的传输协议，**经由HTTP进行通信，利用SSL/TLS(TLS是传输层加密协议，前身是SSL协议)建立全信道，加密数据包**。HTTPS使用的主要目的是**提供对网站服务器的身份认证**，同时**保护交换数据的隐私与完整性**。


## Http与Https比较

HTTP特点：
- 无状态：HTTP服务器不保存关于客户的任何信息。
    比如**访问一个网站需要反复进行登录操作**。
- 无连接：HTTP/1.1之前，由于无状态特点，每次请求需要通过TCP三次握手四次挥手，和服务器重新建立连接。
    比如某个客户机在短时间多次请求同一个资源，服务器并不能区别是否已经响应过用户的请求，所以每次需要重新响应请求，需要耗费不必要的时间和流量。
- 基于请求和响应：由客户端发起请求，服务端响应
- 通信使用**明文**、请求和响应不会对通信方进行确认、无法保护数据的完整性。

针对无状态的解决策略：
- 通过Cookie/Session技术
- HTTP/1.1**持久连接**（HTTP **keep-alive**）方法，只要任意一端没有明确提出断开连接，则保持TCP连接状态，在请求首部字段中的`Connection: keep-alive`即为表明使用了持久连接。

HTTPS特点：
基于HTTP协议，通过SSL或TLS提供**加密**处理数据（采用混合加密技术，中间者无法直接查看明文内容）、**验证对方身份**（通过证书认证客户端访问的是自己的服务器）以及**数据完整性保护**（防止传输的内容被中间人冒充或者篡改）。



# TCP与UDP